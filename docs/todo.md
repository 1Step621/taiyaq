# TaiyaqバックエンドのTODOリスト

このドキュメントは、`taiyaq`バックエンドにおける残りのタスクと改善点を示します。

## 高優先度

- **実際の通知送信ロジックの実装**: `src/data.rs`の`send_notification`メソッドは現在プレースホルダーです。LINE、Discord、Emailを介して通知を送信する実際のロジックを実装してください。
- **LINE Botメッセージ解析の強化**: `src/api/handler.rs`の`line_callback`関数を改善し、ユーザーメッセージを堅牢に解析して以下に対応できるようにしてください。
  - ステータス照会用の注文ID。
  - 通知設定用のメールアドレスまたはLINEユーザーID。
  - 様々なユーザー入力に対応し、役立つ応答を提供する。
- **`estimatedWaitMinutes`計算の改善**: `get_order_details`の現在の推定は簡略化されています。現在の待機中の注文数、生産能力などの要因に基づいた、より洗練されたアルゴリズムを実装してください。
- **data**の保存: 定期的にdataを保存するようにしてください。

## 中優先度

- **「cooking」ステータス遷移の実装**: 現在、注文は「waiting」から「ready」に直接遷移します。注文を明示的に「cooking」ステータスに設定するメカニズム（例: スタッフAPIエンドポイントまたは自動ロジック）を導入してください。
- **注文キャンセルの在庫への影響の処理**: 注文がキャンセルされた場合、そのために予約されていた商品は理想的には`unallocated_stock`に戻されるべきです。`cancel_order`関数にこのロジックを実装してください。

## 低優先度

- **エラー処理とバリデーション**: すべてのAPIエンドポイントでエラー処理と入力バリデーションを強化してください。
- **永続化**: メモリ内ストレージではなく、注文データを永続化するためのデータベース層（例: PostgreSQL、SQLite）を実装してください。
- **認証と認可**: スタッフAPIとボットAPIに認証を追加し、すべてのエンドポイントに認可チェックを追加してください。
